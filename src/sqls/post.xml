<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="postwrite">

<insert id="setcam" parameterType="HashMap">
	INSERT INTO INFO_CAMERA VALUES(SEQ_CAMERA.NEXTVAL,#{postcamera},NULL)
</insert>
<insert id="setcamseq" parameterType="HashMap">
	INSERT INTO MEMBER_MYPAGE_CAMERA VALUES(#{memuserseq},(
		SELECT CAMERA_SEQ
		FROM INFO_CAMERA
		WHERE #{postcamera}=CAMERA_SERIAL))
</insert>
<insert id="insertPost" parameterType="bit.com.inpho.dto.PostDto"> 
<selectKey keyProperty="post_seq" resultType="Integer" order="AFTER">
			SELECT  SEQ_POST.CURRVAL
			FROM DUAL
</selectKey>
	INSERT INTO POST 
	VALUES(SEQ_POST.NEXTVAL,#{user_seq},#{camera_seq},#{content},SYSDATE,#{filepath},0,#{location},0) 
</insert>

<select id ="getcamseq" parameterType="bit.com.inpho.dto.PostDto" resultType="Integer">
	SELECT CAMERA_SEQ
	FROM INFO_CAMERA
	WHERE #{camera_serial}=CAMERA_SERIAL
</select>
<insert id="addHashTag"  parameterType="bit.com.inpho.dto.PostDto"  useGeneratedKeys="true" keyProperty="hseq">
	INSERT into INFO_HASHTAG (TAG_SEQ,HASHTAG)
	SELECT SEQ_TAG.NEXTVAL, A.HASHTAG  FROM(
	<foreach item="list" collection="tags" separator="UNION ALL" >
	 SELECT #{list} AS HASHTAG
	 FROM DUAL
	</foreach>
	) A
</insert> 
<insert id="addHashTag1"  parameterType="java.util.Map">
	INSERT into POST_HASHTAG (POST_SEQ,TAG_SEQ)
	SELECT SEQ_TAG, A.POST_SEQ FROM(
	<foreach item="item" collection="seq" separator="UNION ALL" >
	SELECT #{item} AS POST_SEQ
	</foreach>
	) A
</insert>

	<insert id="addLocation" parameterType="bit.com.inpho.dto.PostLocationDto">
		INSERT INTO POST_LOCATION
		(POST_SEQ,LATITUDE,LONGITUDE)
		VALUES(#{post_seq},#{latitude},#{longitude})
	</insert>
	<select id="getHashTagName" parameterType="bit.com.inpho.dto.PostDto"
		resultType="bit.com.inpho.dto.PostHashTagInfoDto">
		SELECT IH.TAG_SEQ, IH.HASHTAG, PH.POST_SEQ
		FROM INFO_HASHTAG
		IH, POST_HASHTAG PH
		WHERE IH.TAG_SEQ = PH.TAG_SEQ
		AND PH.POST_SEQ =
		#{post_seq}
	</select>
	<select id="getCamera" parameterType="bit.com.inpho.dto.MemberDto"
		resultType="bit.com.inpho.dto.PostDto">
		SELECT CAMERA_SERIAL,CAMERA_SEQ
		FROM INFO_CAMERA
 		WHERE
		CAMERA_SEQ IN
		(SELECT CAMERA_SEQ
		FROM MEMBER_MYPAGE_CAMERA
		WHERE USER_SEQ
		= #{user_seq}) 
	</select>
	<insert id="addcam" parameterType="bit.com.inpho.dto.PostDto">
		<selectKey keyProperty="camera_seq" resultType="Integer">
			SELECT SEQ_CAMERA.NEXTVAL 
			FROM DUAL
		</selectKey>
		INSERT INTO INFO_CAMERA
			 VALUES (
					#{camera_seq},
					#{camera}
					)
	</insert>
</mapper>